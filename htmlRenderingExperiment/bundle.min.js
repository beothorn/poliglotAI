!function(){"use strict";const e="4.68.4";let t,s,n,r,o,a,i,l,c,u=!1;class h{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}t||function(e){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{auto:!1};if(u)throw new Error(`you must \`import 'openai/shims/${e.kind}'\` before importing anything else from openai`);if(t)throw new Error(`can't \`import 'openai/shims/${e.kind}'\` after \`import 'openai/shims/${t}'\``);u=h.auto,t=e.kind,s=e.fetch,e.Request,e.Response,e.Headers,n=e.FormData,e.Blob,r=e.File,o=e.ReadableStream,a=e.getMultipartRequestOptions,i=e.getDefaultAgent,l=e.fileFromPath,c=e.isFsReadStream}(function(){let{manuallyImported:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=e?"You may need to use polyfills":"Add one of these imports before your first `import â€¦ from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let s,n,r,o;try{s=fetch,n=Request,r=Response,o=Headers}catch(e){throw new Error(`this environment is missing the following Web Fetch API type: ${e.message}. ${t}`)}return{kind:"web",fetch:s,Request:n,Response:r,Headers:o,FormData:"undefined"!=typeof FormData?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${t}`)}},Blob:"undefined"!=typeof Blob?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${t}`)}},File:"undefined"!=typeof File?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${t}`)}},ReadableStream:"undefined"!=typeof ReadableStream?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${t}`)}},getMultipartRequestOptions:async(e,t)=>({...t,body:new h(e)}),getDefaultAgent:e=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:e=>!1}}(),{auto:!0});class d{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];const s=d.NEWLINE_CHARS.has(t[t.length-1]||"");let n=t.split(d.NEWLINE_REGEXP);return s&&n.pop(),1!==n.length||s?(this.buffer.length>0&&(n=[this.buffer.join("")+n[0],...n.slice(1)],this.buffer=[]),s||(this.buffer=[n.pop()||""]),n):(this.buffer.push(n[0]),[])}decodeText(e){if(null==e)return"";if("string"==typeof e)return e;if("undefined"!=typeof Buffer){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new re(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if("undefined"!=typeof TextDecoder){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new re(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new re("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}}d.NEWLINE_CHARS=new Set(["\n","\r"]),d.NEWLINE_REGEXP=/\r\n|[\n\r]/g;class f{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let s=!1;return new f((async function*(){if(s)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let n=!1;try{for await(const s of async function*(e,t){if(!e.body)throw t.abort(),new re("Attempted to iterate over a response with no body");const s=new m,n=new d,r=g(e.body);for await(const e of async function*(e){let t=new Uint8Array;for await(const s of e){if(null==s)continue;const e=s instanceof ArrayBuffer?new Uint8Array(s):"string"==typeof s?(new TextEncoder).encode(s):s;let n,r=new Uint8Array(t.length+e.length);for(r.set(t),r.set(e,t.length),t=r;-1!==(n=p(t));)yield t.slice(0,n),t=t.slice(n)}t.length>0&&(yield t)}(r))for(const t of n.decode(e)){const e=s.decode(t);e&&(yield e)}for(const e of n.flush()){const t=s.decode(e);t&&(yield t)}}(e,t))if(!n)if(s.data.startsWith("[DONE]"))n=!0;else if(null===s.event){let e;try{e=JSON.parse(s.data)}catch(e){throw console.error("Could not parse message into JSON:",s.data),console.error("From chunk:",s.raw),e}if(e&&e.error)throw new oe(void 0,e.error,void 0,void 0);yield e}else{let e;try{e=JSON.parse(s.data)}catch(e){throw console.error("Could not parse message into JSON:",s.data),console.error("From chunk:",s.raw),e}if("error"==s.event)throw new oe(void 0,e.error,e.message,void 0);yield{event:s.event,data:e}}n=!0}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;throw e}finally{n||t.abort()}}),t)}static fromReadableStream(e,t){let s=!1;return new f((async function*(){if(s)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let n=!1;try{for await(const t of async function*(){const t=new d,s=g(e);for await(const e of s)for(const s of t.decode(e))yield s;for(const e of t.flush())yield e}())n||t&&(yield JSON.parse(t));n=!0}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;throw e}finally{n||t.abort()}}),t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],s=this.iterator(),n=n=>({next:()=>{if(0===n.length){const n=s.next();e.push(n),t.push(n)}return n.shift()}});return[new f((()=>n(e)),this.controller),new f((()=>n(t)),this.controller)]}toReadableStream(){const e=this;let t;const s=new TextEncoder;return new o({async start(){t=e[Symbol.asyncIterator]()},async pull(e){try{const{value:n,done:r}=await t.next();if(r)return e.close();const o=s.encode(JSON.stringify(n)+"\n");e.enqueue(o)}catch(t){e.error(t)}},async cancel(){await(t.return?.())}})}}function p(e){for(let t=0;t<e.length-2;t++){if(10===e[t]&&10===e[t+1])return t+2;if(13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return-1}class m{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,s,n]=function(e,t){const s=e.indexOf(t);if(-1!==s)return[e.substring(0,s),t,e.substring(s+t.length)];return[e,"",""]}(e,":");return n.startsWith(" ")&&(n=n.substring(1)),"event"===t?this.event=n:"data"===t&&this.data.push(n),null}}function g(e){if(e[Symbol.asyncIterator])return e;const t=e.getReader();return{async next(){try{const e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){const e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}const y=e=>null!=e&&"object"==typeof e&&"string"==typeof e.url&&"function"==typeof e.blob,w=e=>null!=e&&"object"==typeof e&&"string"==typeof e.name&&"number"==typeof e.lastModified&&b(e),b=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer;async function _(e,t,s){if(e=await e,w(e))return e;if(y(e)){const n=await e.blob();t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()??"unknown_file");const o=b(n)?[await n.arrayBuffer()]:[n];return new r(o,t,s)}const n=await async function(e){let t=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(b(e))t.push(await e.arrayBuffer());else{if(!x(e))throw new Error(`Unexpected data type: ${typeof e}; constructor: ${e?.constructor?.name}; props: ${function(e){const t=Object.getOwnPropertyNames(e);return`[${t.map((e=>`"${e}"`)).join(", ")}]`}(e)}`);for await(const s of e)t.push(s)}return t}(e);if(t||(t=function(e){return v(e.name)||v(e.filename)||v(e.path)?.split(/[\\/]/).pop()}(e)??"unknown_file"),!s?.type){const e=n[0]?.type;"string"==typeof e&&(s={...s,type:e})}return new r(n,t,s)}const v=e=>"string"==typeof e?e:"undefined"!=typeof Buffer&&e instanceof Buffer?String(e):void 0,x=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator],S=e=>e&&"object"==typeof e&&e.body&&"MultipartBody"===e[Symbol.toStringTag],A=async e=>{const t=await I(e.body);return a(t,e)},I=async e=>{const t=new n;return await Promise.all(Object.entries(e||{}).map((e=>{let[s,n]=e;return E(t,s,n)}))),t},E=async(e,t,s)=>{if(void 0!==s){if(null==s)throw new TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof s||"number"==typeof s||"boolean"==typeof s)e.append(t,String(s));else if((e=>w(e)||y(e)||c(e))(s)){const n=await _(s);e.append(t,n)}else if(Array.isArray(s))await Promise.all(s.map((s=>E(e,t+"[]",s))));else{if("object"!=typeof s)throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${s} instead`);await Promise.all(Object.entries(s).map((s=>{let[n,r]=s;return E(e,`${t}[${n}]`,r)})))}}};var R,P=function(e,t,s,n,r){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?r.call(e,s):r?r.value=s:t.set(e,s),s},O=function(e,t,s,n){if("a"===s&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?n:"a"===s?n.call(e):n?n.value:t.get(e)};async function C(e){const{response:t}=e;if(e.options.stream)return ee("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller):f.fromSSEResponse(t,e.controller);if(204===t.status)return null;if(e.options.__binaryResponse)return t;const s=t.headers.get("content-type");if(s?.includes("application/json")||s?.includes("application/vnd.api+json")){const e=await t.json();return ee("response",t.status,t.url,t.headers,e),k(e,t)}const n=await t.text();return ee("response",t.status,t.url,t.headers,n),n}function k(e,t){return!e||"object"!=typeof e||Array.isArray(e)?e:Object.defineProperty(e,"_request_id",{value:t.headers.get("x-request-id"),enumerable:!1})}class $ extends Promise{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:C;super((e=>{e(null)})),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new $(this.responsePromise,(async t=>k(e(await this.parseResponse(t),t),t.response)))}asResponse(){return this.responsePromise.then((e=>e.response))}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class T{constructor(e){let{baseURL:t,maxRetries:n=2,timeout:r=6e5,httpAgent:o,fetch:a}=e;this.baseURL=t,this.maxRetries=K("maxRetries",n),this.timeout=K("timeout",r),this.httpAgent=o,this.fetch=a??s}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...W(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${te()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,s){return this.request(Promise.resolve(s).then((async s=>{const n=s&&b(s?.body)?new DataView(await s.body.arrayBuffer()):s?.body instanceof DataView?s.body:s?.body instanceof ArrayBuffer?new DataView(s.body):s&&ArrayBuffer.isView(s?.body)?new DataView(s.body.buffer):s?.body;return{method:e,path:t,...s,body:n}})))}getAPIList(e,t,s){return this.requestAPIList(t,{method:"get",path:e,...s})}calculateContentLength(e){if("string"==typeof e){if("undefined"!=typeof Buffer)return Buffer.byteLength(e,"utf8").toString();if("undefined"!=typeof TextEncoder){return(new TextEncoder).encode(e).length.toString()}}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e){let{retryCount:t=0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{method:s,path:n,query:r,headers:o={}}=e,a=ArrayBuffer.isView(e.body)||e.__binaryRequest&&"string"==typeof e.body?e.body:S(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,l=this.calculateContentLength(a),c=this.buildURL(n,r);"timeout"in e&&K("timeout",e.timeout);const u=e.timeout??this.timeout,h=e.httpAgent??this.httpAgent??i(c),d=u+1e3;"number"==typeof h?.options?.timeout&&d>(h.options.timeout??0)&&(h.options.timeout=d),this.idempotencyHeader&&"get"!==s&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),o[this.idempotencyHeader]=e.idempotencyKey);return{req:{method:s,...a&&{body:a},headers:this.buildHeaders({options:e,headers:o,contentLength:l,retryCount:t}),...h&&{agent:h},signal:e.signal??null},url:c,timeout:u}}buildHeaders(e){let{options:s,headers:n,contentLength:r,retryCount:o}=e;const a={};r&&(a["content-length"]=r);const i=this.defaultHeaders(s);return Z(a,i),Z(a,n),S(s.body)&&"node"!==t&&delete a["content-type"],void 0===se(i,"x-stainless-retry-count")&&void 0===se(n,"x-stainless-retry-count")&&(a["x-stainless-retry-count"]=String(o)),this.validateHeaders(a,n),a}async prepareOptions(e){}async prepareRequest(e,t){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map((e=>[...e]))):{...e}:{}}makeStatusError(e,t,s,n){return oe.generate(e,t,s,n)}request(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new $(this.makeRequest(e,t))}async makeRequest(e,t){const s=await e,n=s.maxRetries??this.maxRetries;null==t&&(t=n),await this.prepareOptions(s);const{req:r,url:o,timeout:a}=this.buildRequest(s,{retryCount:n-t});if(await this.prepareRequest(r,{url:o,options:s}),ee("request",o,s,r.headers),s.signal?.aborted)throw new ae;const i=new AbortController,l=await this.fetchWithTimeout(o,r,a,i).catch(z);if(l instanceof Error){if(s.signal?.aborted)throw new ae;if(t)return this.retryRequest(s,t);if("AbortError"===l.name)throw new le;throw new ie({cause:l})}const c=B(l.headers);if(!l.ok){if(t&&this.shouldRetry(l)){return ee(`response (error; ${`retrying, ${t} attempts remaining`})`,l.status,o,c),this.retryRequest(s,t,c)}const e=await l.text().catch((e=>z(e).message)),n=H(e),r=n?void 0:e;ee(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,l.status,o,c,r);throw this.makeStatusError(l.status,n,r,c)}return{response:l,options:s,controller:i}}requestAPIList(e,t){const s=this.makeRequest(t,null);return new N(this,s,e)}buildURL(e,t){const s=J(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),n=this.defaultQuery();return G(n)||(t={...n,...t}),"object"==typeof t&&t&&!Array.isArray(t)&&(s.search=this.stringifyQuery(t)),s.toString()}stringifyQuery(e){return Object.entries(e).filter((e=>{let[t,s]=e;return void 0!==s})).map((e=>{let[t,s]=e;if("string"==typeof s||"number"==typeof s||"boolean"==typeof s)return`${encodeURIComponent(t)}=${encodeURIComponent(s)}`;if(null===s)return`${encodeURIComponent(t)}=`;throw new re(`Cannot stringify type ${typeof s}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)})).join("&")}async fetchWithTimeout(e,t,s,n){const{signal:r,...o}=t||{};r&&r.addEventListener("abort",(()=>n.abort()));const a=setTimeout((()=>n.abort()),s);return this.getRequestClient().fetch.call(void 0,e,{signal:n.signal,...o}).finally((()=>{clearTimeout(a)}))}getRequestClient(){return{fetch:this.fetch}}shouldRetry(e){const t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||(409===e.status||(429===e.status||e.status>=500)))}async retryRequest(e,t,s){let n;const r=s?.["retry-after-ms"];if(r){const e=parseFloat(r);Number.isNaN(e)||(n=e)}const o=s?.["retry-after"];if(o&&!n){const e=parseFloat(o);n=Number.isNaN(e)?Date.parse(o)-Date.now():1e3*e}if(!(n&&0<=n&&n<6e4)){const s=e.maxRetries??this.maxRetries;n=this.calculateDefaultRetryTimeoutMillis(t,s)}return await V(n),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const s=t-e;return Math.min(.5*Math.pow(2,s),8)*(1-.25*Math.random())*1e3}getUserAgent(){return`${this.constructor.name}/JS ${e}`}}class M{constructor(e,t,s,n){R.set(this,void 0),P(this,R,e,"f"),this.options=n,this.response=t,this.body=s}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageInfo()}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new re("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e&&"object"==typeof t.query)t.query={...t.query,...e.params};else if("url"in e){const s=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[t,n]of s)e.url.searchParams.set(t,n);t.query=void 0,t.path=e.url.toString()}return await O(this,R,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(R=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class N extends ${constructor(e,t,s){super(t,(async t=>new s(e,t.response,await C(t),t.options)))}async*[Symbol.asyncIterator](){const e=await(this);for await(const t of e)yield t}}const B=e=>new Proxy(Object.fromEntries(e.entries()),{get(e,t){const s=t.toString();return e[s.toLowerCase()]||e[s]}}),j={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},L=e=>"object"==typeof e&&null!==e&&!G(e)&&Object.keys(e).every((e=>Y(j,e))),D=()=>{if("undefined"!=typeof Deno&&null!=Deno.build)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":e,"X-Stainless-OS":q(Deno.build.os),"X-Stainless-Arch":F(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":e,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if("[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0))return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":e,"X-Stainless-OS":q(process.platform),"X-Stainless-Arch":F(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const t=function(){if("undefined"==typeof navigator||!navigator)return null;const e=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:t,pattern:s}of e){const e=s.exec(navigator.userAgent);if(e){return{browser:t,version:`${e[1]||0}.${e[2]||0}.${e[3]||0}`}}}return null}();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":e,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":e,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};const F=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",q=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown";let U;const W=()=>U??(U=D()),H=e=>{try{return JSON.parse(e)}catch(e){return}},X=new RegExp("^(?:[a-z]+:)?//","i"),J=e=>X.test(e),V=e=>new Promise((t=>setTimeout(t,e))),K=(e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new re(`${e} must be an integer`);if(t<0)throw new re(`${e} must be a positive integer`);return t},z=e=>{if(e instanceof Error)return e;if("object"==typeof e&&null!==e)try{return new Error(JSON.stringify(e))}catch{}return new Error(e)},Q=e=>"undefined"!=typeof process?process.env?.[e]?.trim()??void 0:"undefined"!=typeof Deno?Deno.env?.get?.(e)?.trim():void 0;function G(e){if(!e)return!0;for(const t in e)return!1;return!0}function Y(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Z(e,t){for(const s in t){if(!Y(t,s))continue;const n=s.toLowerCase();if(!n)continue;const r=t[s];null===r?delete e[n]:void 0!==r&&(e[n]=r)}}function ee(e){if("undefined"!=typeof process&&"true"===process?.env?.DEBUG){for(var t=arguments.length,s=new Array(t>1?t-1:0),n=1;n<t;n++)s[n-1]=arguments[n];console.log(`OpenAI:DEBUG:${e}`,...s)}}const te=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),se=(e,t)=>{const s=t.toLowerCase();if((e=>"function"==typeof e?.get)(e)){const n=t[0]?.toUpperCase()+t.substring(1).replace(/([^\w])(\w)/g,((e,t,s)=>t+s.toUpperCase()));for(const r of[t,s,t.toUpperCase(),n]){const t=e.get(r);if(t)return t}}for(const[n,r]of Object.entries(e))if(n.toLowerCase()===s)return Array.isArray(r)?(r.length<=1||console.warn(`Received ${r.length} entries for the ${t} header, using the first entry.`),r[0]):r};function ne(e){return null!=e&&"object"==typeof e&&!Array.isArray(e)}class re extends Error{}class oe extends re{constructor(e,t,s,n){super(`${oe.makeMessage(e,t,s)}`),this.status=e,this.headers=n,this.request_id=n?.["x-request-id"];const r=t;this.error=r,this.code=r?.code,this.param=r?.param,this.type=r?.type}static makeMessage(e,t,s){const n=t?.message?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):s;return e&&n?`${e} ${n}`:e?`${e} status code (no body)`:n||"(no status code or body)"}static generate(e,t,s,n){if(!e)return new ie({message:s,cause:z(t)});const r=t?.error;return 400===e?new ce(e,r,s,n):401===e?new ue(e,r,s,n):403===e?new he(e,r,s,n):404===e?new de(e,r,s,n):409===e?new fe(e,r,s,n):422===e?new pe(e,r,s,n):429===e?new me(e,r,s,n):e>=500?new ge(e,r,s,n):new oe(e,r,s,n)}}class ae extends oe{constructor(){let{message:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(void 0,void 0,e||"Request was aborted.",void 0),this.status=void 0}}class ie extends oe{constructor(e){let{message:t,cause:s}=e;super(void 0,void 0,t||"Connection error.",void 0),this.status=void 0,s&&(this.cause=s)}}class le extends ie{constructor(){let{message:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({message:e??"Request timed out."})}}class ce extends oe{constructor(){super(...arguments),this.status=400}}class ue extends oe{constructor(){super(...arguments),this.status=401}}class he extends oe{constructor(){super(...arguments),this.status=403}}class de extends oe{constructor(){super(...arguments),this.status=404}}class fe extends oe{constructor(){super(...arguments),this.status=409}}class pe extends oe{constructor(){super(...arguments),this.status=422}}class me extends oe{constructor(){super(...arguments),this.status=429}}class ge extends oe{}class ye extends re{constructor(){super("Could not parse response content as the length limit was reached")}}class we extends re{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}const be="RFC3986",_e={RFC1738:e=>String(e).replace(/%20/g,"+"),RFC3986:e=>String(e)},ve=Array.isArray,xe=(()=>{const e=[];for(let t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e})(),Se=1024;function Ae(e,t){if(ve(e)){const s=[];for(let n=0;n<e.length;n+=1)s.push(t(e[n]));return s}return t(e)}const Ie=Object.prototype.hasOwnProperty,Ee={brackets:e=>String(e)+"[]",comma:"comma",indices:(e,t)=>String(e)+"["+t+"]",repeat:e=>String(e)},Re=Array.isArray,Pe=Array.prototype.push,Oe=function(e,t){Pe.apply(e,Re(t)?t:[t])},Ce=Date.prototype.toISOString,ke={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:(e,t,s,n,r)=>{if(0===e.length)return e;let o=e;if("symbol"==typeof e?o=Symbol.prototype.toString.call(e):"string"!=typeof e&&(o=String(e)),"iso-8859-1"===s)return escape(o).replace(/%u[0-9a-f]{4}/gi,(function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"}));let a="";for(let e=0;e<o.length;e+=Se){const t=o.length>=Se?o.slice(e,e+Se):o,s=[];for(let e=0;e<t.length;++e){let n=t.charCodeAt(e);45===n||46===n||95===n||126===n||n>=48&&n<=57||n>=65&&n<=90||n>=97&&n<=122||"RFC1738"===r&&(40===n||41===n)?s[s.length]=t.charAt(e):n<128?s[s.length]=xe[n]:n<2048?s[s.length]=xe[192|n>>6]+xe[128|63&n]:n<55296||n>=57344?s[s.length]=xe[224|n>>12]+xe[128|n>>6&63]+xe[128|63&n]:(e+=1,n=65536+((1023&n)<<10|1023&t.charCodeAt(e)),s[s.length]=xe[240|n>>18]+xe[128|n>>12&63]+xe[128|n>>6&63]+xe[128|63&n])}a+=s.join("")}return a},encodeValuesOnly:!1,format:be,formatter:_e[be],indices:!1,serializeDate:e=>Ce.call(e),skipNulls:!1,strictNullHandling:!1};const $e={};function Te(e,t,s,n,r,o,a,i,l,c,u,h,d,f,p,m,g,y){let w=e,b=y,_=0,v=!1;for(;void 0!==(b=b.get($e))&&!v;){const t=b.get(e);if(_+=1,void 0!==t){if(t===_)throw new RangeError("Cyclic object value");v=!0}void 0===b.get($e)&&(_=0)}if("function"==typeof c?w=c(t,w):w instanceof Date?w=d?.(w):"comma"===s&&Re(w)&&(w=Ae(w,(function(e){return e instanceof Date?d?.(e):e}))),null===w){if(o)return l&&!m?l(t,ke.encoder,g,"key",f):t;w=""}if("string"==typeof(x=w)||"number"==typeof x||"boolean"==typeof x||"symbol"==typeof x||"bigint"==typeof x||function(e){return!(!e||"object"!=typeof e||!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e)))}(w)){if(l){const e=m?t:l(t,ke.encoder,g,"key",f);return[p?.(e)+"="+p?.(l(w,ke.encoder,g,"value",f))]}return[p?.(t)+"="+p?.(String(w))]}var x;const S=[];if(void 0===w)return S;let A;if("comma"===s&&Re(w))m&&l&&(w=Ae(w,l)),A=[{value:w.length>0?w.join(",")||null:void 0}];else if(Re(c))A=c;else{const e=Object.keys(w);A=u?e.sort(u):e}const I=i?String(t).replace(/\./g,"%2E"):String(t),E=n&&Re(w)&&1===w.length?I+"[]":I;if(r&&Re(w)&&0===w.length)return E+"[]";for(let t=0;t<A.length;++t){const b=A[t],v="object"==typeof b&&void 0!==b.value?b.value:w[b];if(a&&null===v)continue;const x=h&&i?b.replace(/\./g,"%2E"):b,I=Re(w)?"function"==typeof s?s(E,x):E:E+(h?"."+x:"["+x+"]");y.set(e,_);const R=new WeakMap;R.set($e,y),Oe(S,Te(v,I,s,n,r,o,a,i,"comma"===s&&m&&Re(w)?null:l,c,u,h,d,f,p,m,g,R))}return S}function Me(e){let t=e;const s=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ke;if(void 0!==e.allowEmptyArrays&&"boolean"!=typeof e.allowEmptyArrays)throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==e.encodeDotInKeys&&"boolean"!=typeof e.encodeDotInKeys)throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw new TypeError("Encoder has to be a function.");const t=e.charset||ke.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let s=be;if(void 0!==e.format){if(!Ie.call(_e,e.format))throw new TypeError("Unknown format option provided.");s=e.format}const n=_e[s];let r,o=ke.filter;if(("function"==typeof e.filter||Re(e.filter))&&(o=e.filter),r=e.arrayFormat&&e.arrayFormat in Ee?e.arrayFormat:"indices"in e?e.indices?"indices":"repeat":ke.arrayFormat,"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const a=void 0===e.allowDots?1==!!e.encodeDotInKeys||ke.allowDots:!!e.allowDots;return{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:ke.addQueryPrefix,allowDots:a,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:ke.allowEmptyArrays,arrayFormat:r,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:ke.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:void 0===e.delimiter?ke.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:ke.encode,encodeDotInKeys:"boolean"==typeof e.encodeDotInKeys?e.encodeDotInKeys:ke.encodeDotInKeys,encoder:"function"==typeof e.encoder?e.encoder:ke.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:ke.encodeValuesOnly,filter:o,format:s,formatter:n,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:ke.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:ke.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:ke.strictNullHandling}}(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{});let n,r;"function"==typeof s.filter?(r=s.filter,t=r("",t)):Re(s.filter)&&(r=s.filter,n=r);const o=[];if("object"!=typeof t||null===t)return"";const a=Ee[s.arrayFormat],i="comma"===a&&s.commaRoundTrip;n||(n=Object.keys(t)),s.sort&&n.sort(s.sort);const l=new WeakMap;for(let e=0;e<n.length;++e){const r=n[e];s.skipNulls&&null===t[r]||Oe(o,Te(t[r],r,a,i,s.allowEmptyArrays,s.strictNullHandling,s.skipNulls,s.encodeDotInKeys,s.encode?s.encoder:null,s.filter,s.sort,s.allowDots,s.serializeDate,s.format,s.formatter,s.encodeValuesOnly,s.charset,l))}const c=o.join(s.delimiter);let u=!0===s.addQueryPrefix?"?":"";return s.charsetSentinel&&("iso-8859-1"===s.charset?u+="utf8=%26%2310003%3B&":u+="utf8=%E2%9C%93&"),c.length>0?u+c:""}class Ne extends M{constructor(e,t,s,n){super(e,t,s,n),this.data=s.data||[],this.object=s.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class Be extends M{constructor(e,t,s,n){super(e,t,s,n),this.data=s.data||[]}getPaginatedItems(){return this.data??[]}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){const e=this.getPaginatedItems();if(!e.length)return null;const t=e[e.length-1]?.id;return t?{params:{after:t}}:null}}class je{constructor(e){this._client=e}}let Le=class extends je{create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}};Le||(Le={});let De=class extends je{constructor(){super(...arguments),this.completions=new Le(this._client)}};!function(e){e.Completions=Le}(De||(De={}));class Fe extends je{create(e,t){return this._client.post("/audio/speech",{body:e,...t,__binaryResponse:!0})}}Fe||(Fe={});class qe extends je{create(e,t){return this._client.post("/audio/transcriptions",A({body:e,...t}))}}qe||(qe={});class Ue extends je{create(e,t){return this._client.post("/audio/translations",A({body:e,...t}))}}Ue||(Ue={});class We extends je{constructor(){super(...arguments),this.transcriptions=new qe(this._client),this.translations=new Ue(this._client),this.speech=new Fe(this._client)}}!function(e){e.Transcriptions=qe,e.Translations=Ue,e.Speech=Fe}(We||(We={}));class He extends je{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return L(e)?this.list({},e):this._client.getAPIList("/batches",Xe,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}}class Xe extends Be{}!function(e){e.BatchesPage=Xe}(He||(He={}));class Je extends je{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,s){return this._client.post(`/assistants/${e}`,{body:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}list(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return L(e)?this.list({},e):this._client.getAPIList("/assistants",Ve,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}}class Ve extends Be{}function Ke(e){return"function"==typeof e.parse}!function(e){e.AssistantsPage=Ve}(Je||(Je={}));const ze=e=>"assistant"===e?.role,Qe=e=>"function"===e?.role,Ge=e=>"tool"===e?.role;var Ye,Ze,et,tt,st,nt,rt,ot,at,it,lt,ct,ut,ht=function(e,t,s,n,r){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?r.call(e,s):r?r.value=s:t.set(e,s),s},dt=function(e,t,s,n){if("a"===s&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?n:"a"===s?n.call(e):n?n.value:t.get(e)};class ft{constructor(){Ye.add(this),this.controller=new AbortController,Ze.set(this,void 0),et.set(this,(()=>{})),tt.set(this,(()=>{})),st.set(this,void 0),nt.set(this,(()=>{})),rt.set(this,(()=>{})),ot.set(this,{}),at.set(this,!1),it.set(this,!1),lt.set(this,!1),ct.set(this,!1),ht(this,Ze,new Promise(((e,t)=>{ht(this,et,e,"f"),ht(this,tt,t,"f")})),"f"),ht(this,st,new Promise(((e,t)=>{ht(this,nt,e,"f"),ht(this,rt,t,"f")})),"f"),dt(this,Ze,"f").catch((()=>{})),dt(this,st,"f").catch((()=>{}))}_run(e){setTimeout((()=>{e().then((()=>{this._emitFinal(),this._emit("end")}),dt(this,Ye,"m",ut).bind(this))}),0)}_connected(){this.ended||(dt(this,et,"f").call(this),this._emit("connect"))}get ended(){return dt(this,at,"f")}get errored(){return dt(this,it,"f")}get aborted(){return dt(this,lt,"f")}abort(){this.controller.abort()}on(e,t){return(dt(this,ot,"f")[e]||(dt(this,ot,"f")[e]=[])).push({listener:t}),this}off(e,t){const s=dt(this,ot,"f")[e];if(!s)return this;const n=s.findIndex((e=>e.listener===t));return n>=0&&s.splice(n,1),this}once(e,t){return(dt(this,ot,"f")[e]||(dt(this,ot,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise(((t,s)=>{ht(this,ct,!0,"f"),"error"!==e&&this.once("error",s),this.once(e,t)}))}async done(){ht(this,ct,!0,"f"),await dt(this,st,"f")}_emit(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),n=1;n<t;n++)s[n-1]=arguments[n];if(dt(this,at,"f"))return;"end"===e&&(ht(this,at,!0,"f"),dt(this,nt,"f").call(this));const r=dt(this,ot,"f")[e];if(r&&(dt(this,ot,"f")[e]=r.filter((e=>!e.once)),r.forEach((e=>{let{listener:t}=e;return t(...s)}))),"abort"===e){const e=s[0];return dt(this,ct,"f")||r?.length||Promise.reject(e),dt(this,tt,"f").call(this,e),dt(this,rt,"f").call(this,e),void this._emit("end")}if("error"===e){const e=s[0];dt(this,ct,"f")||r?.length||Promise.reject(e),dt(this,tt,"f").call(this,e),dt(this,rt,"f").call(this,e),this._emit("end")}}_emitFinal(){}}function pt(e){return"auto-parseable-response-format"===e?.$brand}function mt(e){return"auto-parseable-tool"===e?.$brand}function gt(e,t){const s=e.choices.map((e=>{if("length"===e.finish_reason)throw new ye;if("content_filter"===e.finish_reason)throw new we;return{...e,message:{...e.message,tool_calls:e.message.tool_calls?.map((e=>function(e,t){const s=e.tools?.find((e=>e.function?.name===t.function.name));return{...t,function:{...t.function,parsed_arguments:mt(s)?s.$parseRaw(t.function.arguments):s?.function.strict?JSON.parse(t.function.arguments):null}}}(t,e)))??[],parsed:e.message.content&&!e.message.refusal?yt(t,e.message.content):null}}}));return{...e,choices:s}}function yt(e,t){if("json_schema"!==e.response_format?.type)return null;if("json_schema"===e.response_format?.type){if("$parseRaw"in e.response_format){return e.response_format.$parseRaw(t)}return JSON.parse(t)}return null}function wt(e,t){if(!e)return!1;const s=e.tools?.find((e=>e.function?.name===t.function.name));return mt(s)||s?.function.strict||!1}function bt(e){return!!pt(e.response_format)||(e.tools?.some((e=>mt(e)||"function"===e.type&&!0===e.function.strict))??!1)}Ze=new WeakMap,et=new WeakMap,tt=new WeakMap,st=new WeakMap,nt=new WeakMap,rt=new WeakMap,ot=new WeakMap,at=new WeakMap,it=new WeakMap,lt=new WeakMap,ct=new WeakMap,Ye=new WeakSet,ut=function(e){if(ht(this,it,!0,"f"),e instanceof Error&&"AbortError"===e.name&&(e=new ae),e instanceof ae)return ht(this,lt,!0,"f"),this._emit("abort",e);if(e instanceof re)return this._emit("error",e);if(e instanceof Error){const t=new re(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new re(String(e)))};var _t,vt,xt,St,At,It,Et,Rt,Pt=function(e,t,s,n){if("a"===s&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?n:"a"===s?n.call(e):n?n.value:t.get(e)};const Ot=10;class Ct extends ft{constructor(){super(...arguments),_t.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if("content"in e||(e.content=null),this.messages.push(e),t)if(this._emit("message",e),(Qe(e)||Ge(e))&&e.content)this._emit("functionCallResult",e.content);else if(ze(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(ze(e)&&e.tool_calls)for(const t of e.tool_calls)"function"===t.type&&this._emit("functionCall",t.function)}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new re("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),Pt(this,_t,"m",vt).call(this)}async finalMessage(){return await this.done(),Pt(this,_t,"m",xt).call(this)}async finalFunctionCall(){return await this.done(),Pt(this,_t,"m",St).call(this)}async finalFunctionCallResult(){return await this.done(),Pt(this,_t,"m",At).call(this)}async totalUsage(){return await this.done(),Pt(this,_t,"m",It).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=Pt(this,_t,"m",xt).call(this);t&&this._emit("finalMessage",t);const s=Pt(this,_t,"m",vt).call(this);s&&this._emit("finalContent",s);const n=Pt(this,_t,"m",St).call(this);n&&this._emit("finalFunctionCall",n);const r=Pt(this,_t,"m",At).call(this);null!=r&&this._emit("finalFunctionCallResult",r),this._chatCompletions.some((e=>e.usage))&&this._emit("totalUsage",Pt(this,_t,"m",It).call(this))}async _createChatCompletion(e,t,s){const n=s?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",(()=>this.controller.abort()))),Pt(this,_t,"m",Et).call(this,t);const r=await e.chat.completions.create({...t,stream:!1},{...s,signal:this.controller.signal});return this._connected(),this._addChatCompletion(gt(r,t))}async _runChatCompletion(e,t,s){for(const e of t.messages)this._addMessage(e,!1);return await this._createChatCompletion(e,t,s)}async _runFunctions(e,t,s){const n="function",{function_call:r="auto",stream:o,...a}=t,i="string"!=typeof r&&r?.name,{maxChatCompletions:l=Ot}=s||{},c={};for(const e of t.functions)c[e.name||e.function.name]=e;const u=t.functions.map((e=>({name:e.name||e.function.name,parameters:e.parameters,description:e.description})));for(const e of t.messages)this._addMessage(e,!1);for(let t=0;t<l;++t){const t=await this._createChatCompletion(e,{...a,function_call:r,functions:u,messages:[...this.messages]},s),o=t.choices[0]?.message;if(!o)throw new re("missing message in ChatCompletion response");if(!o.function_call)return;const{name:l,arguments:h}=o.function_call,d=c[l];if(!d){const e=`Invalid function_call: ${JSON.stringify(l)}. Available options are: ${u.map((e=>JSON.stringify(e.name))).join(", ")}. Please try again`;this._addMessage({role:n,name:l,content:e});continue}if(i&&i!==l){const e=`Invalid function_call: ${JSON.stringify(l)}. ${JSON.stringify(i)} requested. Please try again`;this._addMessage({role:n,name:l,content:e});continue}let f;try{f=Ke(d)?await d.parse(h):h}catch(e){this._addMessage({role:n,name:l,content:e instanceof Error?e.message:String(e)});continue}const p=await d.function(f,this),m=Pt(this,_t,"m",Rt).call(this,p);if(this._addMessage({role:n,name:l,content:m}),i)return}}async _runTools(e,t,s){const n="tool",{tool_choice:r="auto",stream:o,...a}=t,i="string"!=typeof r&&r?.function?.name,{maxChatCompletions:l=Ot}=s||{},c=t.tools.map((e=>{if(mt(e)){if(!e.$callback)throw new re("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:e.$callback,name:e.function.name,description:e.function.description||"",parameters:e.function.parameters,parse:e.$parseRaw,strict:!0}}}return e})),u={};for(const e of c)"function"===e.type&&(u[e.function.name||e.function.function.name]=e.function);const h="tools"in t?c.map((e=>"function"===e.type?{type:"function",function:{name:e.function.name||e.function.function.name,parameters:e.function.parameters,description:e.function.description,strict:e.function.strict}}:e)):void 0;for(const e of t.messages)this._addMessage(e,!1);for(let t=0;t<l;++t){const t=await this._createChatCompletion(e,{...a,tool_choice:r,tools:h,messages:[...this.messages]},s),o=t.choices[0]?.message;if(!o)throw new re("missing message in ChatCompletion response");if(!o.tool_calls?.length)return;for(const e of o.tool_calls){if("function"!==e.type)continue;const t=e.id,{name:s,arguments:r}=e.function,o=u[s];if(!o){const e=`Invalid tool_call: ${JSON.stringify(s)}. Available options are: ${Object.keys(u).map((e=>JSON.stringify(e))).join(", ")}. Please try again`;this._addMessage({role:n,tool_call_id:t,content:e});continue}if(i&&i!==s){const e=`Invalid tool_call: ${JSON.stringify(s)}. ${JSON.stringify(i)} requested. Please try again`;this._addMessage({role:n,tool_call_id:t,content:e});continue}let a;try{a=Ke(o)?await o.parse(r):r}catch(e){const s=e instanceof Error?e.message:String(e);this._addMessage({role:n,tool_call_id:t,content:s});continue}const l=await o.function(a,this),c=Pt(this,_t,"m",Rt).call(this,l);if(this._addMessage({role:n,tool_call_id:t,content:c}),i)return}}}}_t=new WeakSet,vt=function(){return Pt(this,_t,"m",xt).call(this).content??null},xt=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(ze(t)){const{function_call:e,...s}=t,n={...s,content:t.content??null,refusal:t.refusal??null};return e&&(n.function_call=e),n}}throw new re("stream ended without producing a ChatCompletionMessage with role=assistant")},St=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(ze(t)&&t?.function_call)return t.function_call;if(ze(t)&&t?.tool_calls?.length)return t.tool_calls.at(-1)?.function}},At=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(Qe(t)&&null!=t.content)return t.content;if(Ge(t)&&null!=t.content&&"string"==typeof t.content&&this.messages.some((e=>"assistant"===e.role&&e.tool_calls?.some((e=>"function"===e.type&&e.id===t.tool_call_id)))))return t.content}},It=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},Et=function(e){if(null!=e.n&&e.n>1)throw new re("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},Rt=function(e){return"string"==typeof e?e:void 0===e?"undefined":JSON.stringify(e)};class kt extends Ct{static runFunctions(e,t,s){const n=new kt,r={...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return n._run((()=>n._runFunctions(e,t,r))),n}static runTools(e,t,s){const n=new kt,r={...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"runTools"}};return n._run((()=>n._runTools(e,t,r))),n}_addMessage(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super._addMessage(e,t),ze(e)&&e.content&&this._emit("content",e.content)}}const $t={STR:1,NUM:2,ARR:4,OBJ:8,NULL:16,BOOL:32,NAN:64,INFINITY:128,MINUS_INFINITY:256,INF:384,SPECIAL:496,ATOM:499,COLLECTION:12,ALL:511};class Tt extends Error{}class Mt extends Error{}const Nt=(e,t)=>{const s=e.length;let n=0;const r=e=>{throw new Tt(`${e} at position ${n}`)},o=e=>{throw new Mt(`${e} at position ${n}`)},a=()=>(h(),n>=s&&r("Unexpected end of input"),'"'===e[n]?i():"{"===e[n]?l():"["===e[n]?c():"null"===e.substring(n,n+4)||$t.NULL&t&&s-n<4&&"null".startsWith(e.substring(n))?(n+=4,null):"true"===e.substring(n,n+4)||$t.BOOL&t&&s-n<4&&"true".startsWith(e.substring(n))?(n+=4,!0):"false"===e.substring(n,n+5)||$t.BOOL&t&&s-n<5&&"false".startsWith(e.substring(n))?(n+=5,!1):"Infinity"===e.substring(n,n+8)||$t.INFINITY&t&&s-n<8&&"Infinity".startsWith(e.substring(n))?(n+=8,1/0):"-Infinity"===e.substring(n,n+9)||$t.MINUS_INFINITY&t&&1<s-n&&s-n<9&&"-Infinity".startsWith(e.substring(n))?(n+=9,-1/0):"NaN"===e.substring(n,n+3)||$t.NAN&t&&s-n<3&&"NaN".startsWith(e.substring(n))?(n+=3,NaN):u()),i=()=>{const a=n;let i=!1;for(n++;n<s&&('"'!==e[n]||i&&"\\"===e[n-1]);)i="\\"===e[n]&&!i,n++;if('"'==e.charAt(n))try{return JSON.parse(e.substring(a,++n-Number(i)))}catch(e){o(String(e))}else if($t.STR&t)try{return JSON.parse(e.substring(a,n-Number(i))+'"')}catch(t){return JSON.parse(e.substring(a,e.lastIndexOf("\\"))+'"')}r("Unterminated string literal")},l=()=>{n++,h();const o={};try{for(;"}"!==e[n];){if(h(),n>=s&&$t.OBJ&t)return o;const r=i();h(),n++;try{const e=a();Object.defineProperty(o,r,{value:e,writable:!0,enumerable:!0,configurable:!0})}catch(e){if($t.OBJ&t)return o;throw e}h(),","===e[n]&&n++}}catch(e){if($t.OBJ&t)return o;r("Expected '}' at end of object")}return n++,o},c=()=>{n++;const s=[];try{for(;"]"!==e[n];)s.push(a()),h(),","===e[n]&&n++}catch(e){if($t.ARR&t)return s;r("Expected ']' at end of array")}return n++,s},u=()=>{if(0===n){"-"===e&&$t.NUM&t&&r("Not sure what '-' is");try{return JSON.parse(e)}catch(s){if($t.NUM&t)try{return"."===e[e.length-1]?JSON.parse(e.substring(0,e.lastIndexOf("."))):JSON.parse(e.substring(0,e.lastIndexOf("e")))}catch(e){}o(String(s))}}const a=n;for("-"===e[n]&&n++;e[n]&&!",]}".includes(e[n]);)n++;n!=s||$t.NUM&t||r("Unterminated number literal");try{return JSON.parse(e.substring(a,n))}catch(s){"-"===e.substring(a,n)&&$t.NUM&t&&r("Not sure what '-' is");try{return JSON.parse(e.substring(a,e.lastIndexOf("e")))}catch(e){o(String(e))}}},h=()=>{for(;n<s&&" \n\r\t".includes(e[n]);)n++};return a()},Bt=e=>function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:$t.ALL;if("string"!=typeof e)throw new TypeError("expecting str, got "+typeof e);if(!e.trim())throw new Error(`${e} is empty`);return Nt(e.trim(),t)}(e,$t.ALL^$t.NUM);var jt,Lt,Dt,Ft,qt,Ut,Wt,Ht,Xt,Jt,Vt,Kt,zt=function(e,t,s,n,r){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?r.call(e,s):r?r.value=s:t.set(e,s),s},Qt=function(e,t,s,n){if("a"===s&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?n:"a"===s?n.call(e):n?n.value:t.get(e)};class Gt extends Ct{constructor(e){super(),jt.add(this),Lt.set(this,void 0),Dt.set(this,void 0),Ft.set(this,void 0),zt(this,Lt,e,"f"),zt(this,Dt,[],"f")}get currentChatCompletionSnapshot(){return Qt(this,Ft,"f")}static fromReadableStream(e){const t=new Gt(null);return t._run((()=>t._fromReadableStream(e))),t}static createChatCompletion(e,t,s){const n=new Gt(t);return n._run((()=>n._runChatCompletion(e,{...t,stream:!0},{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}}))),n}async _createChatCompletion(e,t,s){super._createChatCompletion;const n=s?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",(()=>this.controller.abort()))),Qt(this,jt,"m",qt).call(this);const r=await e.chat.completions.create({...t,stream:!0},{...s,signal:this.controller.signal});this._connected();for await(const e of r)Qt(this,jt,"m",Wt).call(this,e);if(r.controller.signal?.aborted)throw new ae;return this._addChatCompletion(Qt(this,jt,"m",Jt).call(this))}async _fromReadableStream(e,t){const s=t?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",(()=>this.controller.abort()))),Qt(this,jt,"m",qt).call(this),this._connected();const n=f.fromReadableStream(e,this.controller);let r;for await(const e of n)r&&r!==e.id&&this._addChatCompletion(Qt(this,jt,"m",Jt).call(this)),Qt(this,jt,"m",Wt).call(this,e),r=e.id;if(n.controller.signal?.aborted)throw new ae;return this._addChatCompletion(Qt(this,jt,"m",Jt).call(this))}[(Lt=new WeakMap,Dt=new WeakMap,Ft=new WeakMap,jt=new WeakSet,qt=function(){this.ended||zt(this,Ft,void 0,"f")},Ut=function(e){let t=Qt(this,Dt,"f")[e.index];return t||(t={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},Qt(this,Dt,"f")[e.index]=t,t)},Wt=function(e){if(this.ended)return;const t=Qt(this,jt,"m",Kt).call(this,e);this._emit("chunk",e,t);for(const s of e.choices){const e=t.choices[s.index];null!=s.delta.content&&"assistant"===e.message?.role&&e.message?.content&&(this._emit("content",s.delta.content,e.message.content),this._emit("content.delta",{delta:s.delta.content,snapshot:e.message.content,parsed:e.message.parsed})),null!=s.delta.refusal&&"assistant"===e.message?.role&&e.message?.refusal&&this._emit("refusal.delta",{delta:s.delta.refusal,snapshot:e.message.refusal}),null!=s.logprobs?.content&&"assistant"===e.message?.role&&this._emit("logprobs.content.delta",{content:s.logprobs?.content,snapshot:e.logprobs?.content??[]}),null!=s.logprobs?.refusal&&"assistant"===e.message?.role&&this._emit("logprobs.refusal.delta",{refusal:s.logprobs?.refusal,snapshot:e.logprobs?.refusal??[]});const n=Qt(this,jt,"m",Ut).call(this,e);e.finish_reason&&(Qt(this,jt,"m",Xt).call(this,e),null!=n.current_tool_call_index&&Qt(this,jt,"m",Ht).call(this,e,n.current_tool_call_index));for(const t of s.delta.tool_calls??[])n.current_tool_call_index!==t.index&&(Qt(this,jt,"m",Xt).call(this,e),null!=n.current_tool_call_index&&Qt(this,jt,"m",Ht).call(this,e,n.current_tool_call_index)),n.current_tool_call_index=t.index;for(const t of s.delta.tool_calls??[]){const s=e.message.tool_calls?.[t.index];s?.type&&("function"===s?.type&&this._emit("tool_calls.function.arguments.delta",{name:s.function?.name,index:t.index,arguments:s.function.arguments,parsed_arguments:s.function.parsed_arguments,arguments_delta:t.function?.arguments??""}))}}},Ht=function(e,t){if(Qt(this,jt,"m",Ut).call(this,e).done_tool_calls.has(t))return;const s=e.message.tool_calls?.[t];if(!s)throw new Error("no tool call snapshot");if(!s.type)throw new Error("tool call snapshot missing `type`");if("function"===s.type){const e=Qt(this,Lt,"f")?.tools?.find((e=>"function"===e.type&&e.function.name===s.function.name));this._emit("tool_calls.function.arguments.done",{name:s.function.name,index:t,arguments:s.function.arguments,parsed_arguments:mt(e)?e.$parseRaw(s.function.arguments):e?.function.strict?JSON.parse(s.function.arguments):null})}else s.type},Xt=function(e){const t=Qt(this,jt,"m",Ut).call(this,e);if(e.message.content&&!t.content_done){t.content_done=!0;const s=Qt(this,jt,"m",Vt).call(this);this._emit("content.done",{content:e.message.content,parsed:s?s.$parseRaw(e.message.content):null})}e.message.refusal&&!t.refusal_done&&(t.refusal_done=!0,this._emit("refusal.done",{refusal:e.message.refusal})),e.logprobs?.content&&!t.logprobs_content_done&&(t.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:e.logprobs.content})),e.logprobs?.refusal&&!t.logprobs_refusal_done&&(t.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:e.logprobs.refusal}))},Jt=function(){if(this.ended)throw new re("stream has ended, this shouldn't happen");const e=Qt(this,Ft,"f");if(!e)throw new re("request ended without sending any chunks");return zt(this,Ft,void 0,"f"),zt(this,Dt,[],"f"),function(e,t){const{id:s,choices:n,created:r,model:o,system_fingerprint:a,...i}=e,l={...i,id:s,choices:n.map((t=>{let{message:s,finish_reason:n,index:r,logprobs:o,...a}=t;if(!n)throw new re(`missing finish_reason for choice ${r}`);const{content:i=null,function_call:l,tool_calls:c,...u}=s,h=s.role;if(!h)throw new re(`missing role for choice ${r}`);if(l){const{arguments:e,name:t}=l;if(null==e)throw new re(`missing function_call.arguments for choice ${r}`);if(!t)throw new re(`missing function_call.name for choice ${r}`);return{...a,message:{content:i,function_call:{arguments:e,name:t},role:h,refusal:s.refusal??null},finish_reason:n,index:r,logprobs:o}}return c?{...a,index:r,finish_reason:n,logprobs:o,message:{...u,role:h,content:i,refusal:s.refusal??null,tool_calls:c.map(((t,s)=>{const{function:n,type:o,id:a,...i}=t,{arguments:l,name:c,...u}=n||{};if(null==a)throw new re(`missing choices[${r}].tool_calls[${s}].id\n${Yt(e)}`);if(null==o)throw new re(`missing choices[${r}].tool_calls[${s}].type\n${Yt(e)}`);if(null==c)throw new re(`missing choices[${r}].tool_calls[${s}].function.name\n${Yt(e)}`);if(null==l)throw new re(`missing choices[${r}].tool_calls[${s}].function.arguments\n${Yt(e)}`);return{...i,id:a,type:o,function:{...u,name:c,arguments:l}}}))}}:{...a,message:{...u,content:i,role:h,refusal:s.refusal??null},finish_reason:n,index:r,logprobs:o}})),created:r,model:o,object:"chat.completion",...a?{system_fingerprint:a}:{}};return function(e,t){return t&&bt(t)?gt(e,t):{...e,choices:e.choices.map((e=>({...e,message:{...e.message,parsed:null,tool_calls:e.message.tool_calls??[]}})))}}(l,t)}(e,Qt(this,Lt,"f"))},Vt=function(){const e=Qt(this,Lt,"f")?.response_format;return pt(e)?e:null},Kt=function(e){var t,s,n,r;let o=Qt(this,Ft,"f");const{choices:a,...i}=e;o?Object.assign(o,i):o=zt(this,Ft,{...i,choices:[]},"f");for(const{delta:a,finish_reason:i,index:l,logprobs:c=null,...u}of e.choices){let e=o.choices[l];if(e||(e=o.choices[l]={finish_reason:i,index:l,message:{},logprobs:c,...u}),c)if(e.logprobs){const{content:n,refusal:r,...o}=c;Object.assign(e.logprobs,o),n&&((t=e.logprobs).content??(t.content=[]),e.logprobs.content.push(...n)),r&&((s=e.logprobs).refusal??(s.refusal=[]),e.logprobs.refusal.push(...r))}else e.logprobs=Object.assign({},c);if(i&&(e.finish_reason=i,Qt(this,Lt,"f")&&bt(Qt(this,Lt,"f")))){if("length"===i)throw new ye;if("content_filter"===i)throw new we}if(Object.assign(e,u),!a)continue;const{content:h,refusal:d,function_call:f,role:p,tool_calls:m,...g}=a;if(Object.assign(e.message,g),d&&(e.message.refusal=(e.message.refusal||"")+d),p&&(e.message.role=p),f&&(e.message.function_call?(f.name&&(e.message.function_call.name=f.name),f.arguments&&((n=e.message.function_call).arguments??(n.arguments=""),e.message.function_call.arguments+=f.arguments)):e.message.function_call=f),h&&(e.message.content=(e.message.content||"")+h,!e.message.refusal&&Qt(this,jt,"m",Vt).call(this)&&(e.message.parsed=Bt(e.message.content))),m){e.message.tool_calls||(e.message.tool_calls=[]);for(const{index:t,id:s,type:n,function:o,...a}of m){const i=(r=e.message.tool_calls)[t]??(r[t]={});Object.assign(i,a),s&&(i.id=s),n&&(i.type=n),o&&(i.function??(i.function={name:o.name??"",arguments:""})),o?.name&&(i.function.name=o.name),o?.arguments&&(i.function.arguments+=o.arguments,wt(Qt(this,Lt,"f"),i)&&(i.function.parsed_arguments=Bt(i.function.arguments)))}}}return o},Symbol.asyncIterator)](){const e=[],t=[];let s=!1;return this.on("chunk",(s=>{const n=t.shift();n?n.resolve(s):e.push(s)})),this.on("end",(()=>{s=!0;for(const e of t)e.resolve(void 0);t.length=0})),this.on("abort",(e=>{s=!0;for(const s of t)s.reject(e);t.length=0})),this.on("error",(e=>{s=!0;for(const s of t)s.reject(e);t.length=0})),{next:async()=>{if(!e.length)return s?{value:void 0,done:!0}:new Promise(((e,s)=>t.push({resolve:e,reject:s}))).then((e=>e?{value:e,done:!1}:{value:void 0,done:!0}));return{value:e.shift(),done:!1}},return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new f(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function Yt(e){return JSON.stringify(e)}class Zt extends Gt{static fromReadableStream(e){const t=new Zt(null);return t._run((()=>t._fromReadableStream(e))),t}static runFunctions(e,t,s){const n=new Zt(null),r={...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return n._run((()=>n._runFunctions(e,t,r))),n}static runTools(e,t,s){const n=new Zt(t),r={...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"runTools"}};return n._run((()=>n._runTools(e,t,r))),n}}let es=class extends je{parse(e,t){return function(e){for(const t of e??[]){if("function"!==t.type)throw new re(`Currently only \`function\` tool types support auto-parsing; Received \`${t.type}\``);if(!0!==t.function.strict)throw new re(`The \`${t.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap((t=>gt(t,e)))}runFunctions(e,t){return e.stream?Zt.runFunctions(this._client,e,t):kt.runFunctions(this._client,e,t)}runTools(e,t){return e.stream?Zt.runTools(this._client,e,t):kt.runTools(this._client,e,t)}stream(e,t){return Gt.createChatCompletion(this._client,e,t)}};class ts extends je{constructor(){super(...arguments),this.completions=new es(this._client)}}!function(e){e.Completions=es}(ts||(ts={}));var ss,ns,rs,os,as,is,ls,cs,us,hs,ds,fs,ps,ms,gs,ys,ws,bs,_s,vs,xs,Ss,As=function(e,t,s,n){if("a"===s&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?n:"a"===s?n.call(e):n?n.value:t.get(e)},Is=function(e,t,s,n,r){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?r.call(e,s):r?r.value=s:t.set(e,s),s};class Es extends ft{constructor(){super(...arguments),ss.add(this),ns.set(this,[]),rs.set(this,{}),os.set(this,{}),as.set(this,void 0),is.set(this,void 0),ls.set(this,void 0),cs.set(this,void 0),us.set(this,void 0),hs.set(this,void 0),ds.set(this,void 0),fs.set(this,void 0),ps.set(this,void 0)}[(ns=new WeakMap,rs=new WeakMap,os=new WeakMap,as=new WeakMap,is=new WeakMap,ls=new WeakMap,cs=new WeakMap,us=new WeakMap,hs=new WeakMap,ds=new WeakMap,fs=new WeakMap,ps=new WeakMap,ss=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let s=!1;return this.on("event",(s=>{const n=t.shift();n?n.resolve(s):e.push(s)})),this.on("end",(()=>{s=!0;for(const e of t)e.resolve(void 0);t.length=0})),this.on("abort",(e=>{s=!0;for(const s of t)s.reject(e);t.length=0})),this.on("error",(e=>{s=!0;for(const s of t)s.reject(e);t.length=0})),{next:async()=>{if(!e.length)return s?{value:void 0,done:!0}:new Promise(((e,s)=>t.push({resolve:e,reject:s}))).then((e=>e?{value:e,done:!1}:{value:void 0,done:!0}));return{value:e.shift(),done:!1}},return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new Es;return t._run((()=>t._fromReadableStream(e))),t}async _fromReadableStream(e,t){const s=t?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",(()=>this.controller.abort()))),this._connected();const n=f.fromReadableStream(e,this.controller);for await(const e of n)As(this,ss,"m",ms).call(this,e);if(n.controller.signal?.aborted)throw new ae;return this._addRun(As(this,ss,"m",gs).call(this))}toReadableStream(){return new f(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,s,n,r){const o=new Es;return o._run((()=>o._runToolAssistantStream(e,t,s,n,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}}))),o}async _createToolAssistantStream(e,t,s,n,r){const o=r?.signal;o&&(o.aborted&&this.controller.abort(),o.addEventListener("abort",(()=>this.controller.abort())));const a={...n,stream:!0},i=await e.submitToolOutputs(t,s,a,{...r,signal:this.controller.signal});this._connected();for await(const e of i)As(this,ss,"m",ms).call(this,e);if(i.controller.signal?.aborted)throw new ae;return this._addRun(As(this,ss,"m",gs).call(this))}static createThreadAssistantStream(e,t,s){const n=new Es;return n._run((()=>n._threadAssistantStream(e,t,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}}))),n}static createAssistantStream(e,t,s,n){const r=new Es;return r._run((()=>r._runAssistantStream(e,t,s,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}}))),r}currentEvent(){return As(this,ds,"f")}currentRun(){return As(this,fs,"f")}currentMessageSnapshot(){return As(this,as,"f")}currentRunStepSnapshot(){return As(this,ps,"f")}async finalRunSteps(){return await this.done(),Object.values(As(this,rs,"f"))}async finalMessages(){return await this.done(),Object.values(As(this,os,"f"))}async finalRun(){if(await this.done(),!As(this,is,"f"))throw Error("Final run was not received.");return As(this,is,"f")}async _createThreadAssistantStream(e,t,s){const n=s?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",(()=>this.controller.abort())));const r={...t,stream:!0},o=await e.createAndRun(r,{...s,signal:this.controller.signal});this._connected();for await(const e of o)As(this,ss,"m",ms).call(this,e);if(o.controller.signal?.aborted)throw new ae;return this._addRun(As(this,ss,"m",gs).call(this))}async _createAssistantStream(e,t,s,n){const r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",(()=>this.controller.abort())));const o={...s,stream:!0},a=await e.create(t,o,{...n,signal:this.controller.signal});this._connected();for await(const e of a)As(this,ss,"m",ms).call(this,e);if(a.controller.signal?.aborted)throw new ae;return this._addRun(As(this,ss,"m",gs).call(this))}static accumulateDelta(e,t){for(const[s,n]of Object.entries(t)){if(!e.hasOwnProperty(s)){e[s]=n;continue}let t=e[s];if(null!=t)if("index"!==s&&"type"!==s){if("string"==typeof t&&"string"==typeof n)t+=n;else if("number"==typeof t&&"number"==typeof n)t+=n;else{if(!ne(t)||!ne(n)){if(Array.isArray(t)&&Array.isArray(n)){if(t.every((e=>"string"==typeof e||"number"==typeof e))){t.push(...n);continue}for(const e of n){if(!ne(e))throw new Error(`Expected array delta entry to be an object but got: ${e}`);const s=e.index;if(null==s)throw console.error(e),new Error("Expected array delta entry to have an `index` property");if("number"!=typeof s)throw new Error(`Expected array delta entry \`index\` property to be a number but got ${s}`);const n=t[s];null==n?t.push(e):t[s]=this.accumulateDelta(n,e)}continue}throw Error(`Unhandled record type: ${s}, deltaValue: ${n}, accValue: ${t}`)}t=this.accumulateDelta(t,n)}e[s]=t}else e[s]=n;else e[s]=n}return e}_addRun(e){return e}async _threadAssistantStream(e,t,s){return await this._createThreadAssistantStream(t,e,s)}async _runAssistantStream(e,t,s,n){return await this._createAssistantStream(t,e,s,n)}async _runToolAssistantStream(e,t,s,n,r){return await this._createToolAssistantStream(s,e,t,n,r)}}ms=function(e){if(!this.ended)switch(Is(this,ds,e,"f"),As(this,ss,"m",bs).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":As(this,ss,"m",Ss).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":As(this,ss,"m",ws).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":As(this,ss,"m",ys).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},gs=function(){if(this.ended)throw new re("stream has ended, this shouldn't happen");if(!As(this,is,"f"))throw Error("Final run has not been received");return As(this,is,"f")},ys=function(e){const[t,s]=As(this,ss,"m",vs).call(this,e,As(this,as,"f"));Is(this,as,t,"f"),As(this,os,"f")[t.id]=t;for(const e of s){const s=t.content[e.index];"text"==s?.type&&this._emit("textCreated",s.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const s of e.data.delta.content){if("text"==s.type&&s.text){let e=s.text,n=t.content[s.index];if(!n||"text"!=n.type)throw Error("The snapshot associated with this text delta is not text or missing");this._emit("textDelta",e,n.text)}if(s.index!=As(this,ls,"f")){if(As(this,cs,"f"))switch(As(this,cs,"f").type){case"text":this._emit("textDone",As(this,cs,"f").text,As(this,as,"f"));break;case"image_file":this._emit("imageFileDone",As(this,cs,"f").image_file,As(this,as,"f"))}Is(this,ls,s.index,"f")}Is(this,cs,t.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(void 0!==As(this,ls,"f")){const t=e.data.content[As(this,ls,"f")];if(t)switch(t.type){case"image_file":this._emit("imageFileDone",t.image_file,As(this,as,"f"));break;case"text":this._emit("textDone",t.text,As(this,as,"f"))}}As(this,as,"f")&&this._emit("messageDone",e.data),Is(this,as,void 0,"f")}},ws=function(e){const t=As(this,ss,"m",_s).call(this,e);switch(Is(this,ps,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const s=e.data.delta;if(s.step_details&&"tool_calls"==s.step_details.type&&s.step_details.tool_calls&&"tool_calls"==t.step_details.type)for(const e of s.step_details.tool_calls)e.index==As(this,us,"f")?this._emit("toolCallDelta",e,t.step_details.tool_calls[e.index]):(As(this,hs,"f")&&this._emit("toolCallDone",As(this,hs,"f")),Is(this,us,e.index,"f"),Is(this,hs,t.step_details.tool_calls[e.index],"f"),As(this,hs,"f")&&this._emit("toolCallCreated",As(this,hs,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":Is(this,ps,void 0,"f");"tool_calls"==e.data.step_details.type&&As(this,hs,"f")&&(this._emit("toolCallDone",As(this,hs,"f")),Is(this,hs,void 0,"f")),this._emit("runStepDone",e.data,t)}},bs=function(e){As(this,ns,"f").push(e),this._emit("event",e)},_s=function(e){switch(e.event){case"thread.run.step.created":return As(this,rs,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=As(this,rs,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let s=e.data;if(s.delta){const n=Es.accumulateDelta(t,s.delta);As(this,rs,"f")[e.data.id]=n}return As(this,rs,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":As(this,rs,"f")[e.data.id]=e.data}if(As(this,rs,"f")[e.data.id])return As(this,rs,"f")[e.data.id];throw new Error("No snapshot available")},vs=function(e,t){let s=[];switch(e.event){case"thread.message.created":return[e.data,s];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let n=e.data;if(n.delta.content)for(const e of n.delta.content)if(e.index in t.content){let s=t.content[e.index];t.content[e.index]=As(this,ss,"m",xs).call(this,e,s)}else t.content[e.index]=e,s.push(e);return[t,s];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,s];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},xs=function(e,t){return Es.accumulateDelta(t,e)},Ss=function(e){switch(Is(this,fs,e.data,"f"),e.event){case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":Is(this,is,e.data,"f"),As(this,hs,"f")&&(this._emit("toolCallDone",As(this,hs,"f")),Is(this,hs,void 0,"f"))}};class Rs extends je{create(e,t,s){return this._client.post(`/threads/${e}/messages`,{body:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}retrieve(e,t,s){return this._client.get(`/threads/${e}/messages/${t}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}update(e,t,s,n){return this._client.post(`/threads/${e}/messages/${t}`,{body:s,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}list(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2?arguments[2]:void 0;return L(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,Ps,{query:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}del(e,t,s){return this._client.delete(`/threads/${e}/messages/${t}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}}class Ps extends Be{}!function(e){e.MessagesPage=Ps}(Rs||(Rs={}));class Os extends je{retrieve(e,t,s){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=arguments.length>4?arguments[4]:void 0;return L(n)?this.retrieve(e,t,s,{},n):this._client.get(`/threads/${e}/runs/${t}/steps/${s}`,{query:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}list(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3?arguments[3]:void 0;return L(s)?this.list(e,t,{},s):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,Cs,{query:s,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}}class Cs extends Be{}!function(e){e.RunStepsPage=Cs}(Os||(Os={}));class ks extends je{constructor(){super(...arguments),this.steps=new Os(this._client)}create(e,t,s){const{include:n,...r}=t;return this._client.post(`/threads/${e}/runs`,{query:{include:n},body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers},stream:t.stream??!1})}retrieve(e,t,s){return this._client.get(`/threads/${e}/runs/${t}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}update(e,t,s,n){return this._client.post(`/threads/${e}/runs/${t}`,{body:s,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}list(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2?arguments[2]:void 0;return L(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,$s,{query:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}cancel(e,t,s){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}async createAndPoll(e,t,s){const n=await this.create(e,t,s);return await this.poll(e,n.id,s)}createAndStream(e,t,s){return Es.createAssistantStream(e,this._client.beta.threads.runs,t,s)}async poll(e,t,s){const n={...s?.headers,"X-Stainless-Poll-Helper":"true"};for(s?.pollIntervalMs&&(n["X-Stainless-Custom-Poll-Interval"]=s.pollIntervalMs.toString());;){const{data:r,response:o}=await this.retrieve(e,t,{...s,headers:{...s?.headers,...n}}).withResponse();switch(r.status){case"queued":case"in_progress":case"cancelling":let e=5e3;if(s?.pollIntervalMs)e=s.pollIntervalMs;else{const t=o.headers.get("openai-poll-after-ms");if(t){const s=parseInt(t);isNaN(s)||(e=s)}}await V(e);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return r}}}stream(e,t,s){return Es.createAssistantStream(e,this._client.beta.threads.runs,t,s)}submitToolOutputs(e,t,s,n){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:s,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers},stream:s.stream??!1})}async submitToolOutputsAndPoll(e,t,s,n){const r=await this.submitToolOutputs(e,t,s,n);return await this.poll(e,r.id,n)}submitToolOutputsStream(e,t,s,n){return Es.createToolAssistantStream(e,t,this._client.beta.threads.runs,s,n)}}class $s extends Be{}!function(e){e.RunsPage=$s,e.Steps=Os,e.RunStepsPage=Cs}(ks||(ks={}));class Ts extends je{constructor(){super(...arguments),this.runs=new ks(this._client),this.messages=new Rs(this._client)}create(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return L(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,s){return this._client.post(`/threads/${e}`,{body:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers},stream:e.stream??!1})}async createAndRunPoll(e,t){const s=await this.createAndRun(e,t);return await this.runs.poll(s.thread_id,s.id,t)}createAndRunStream(e,t){return Es.createThreadAssistantStream(e,this._client.beta.threads,t)}}!function(e){e.Runs=ks,e.RunsPage=$s,e.Messages=Rs,e.MessagesPage=Ps}(Ts||(Ts={}));let Ms=class extends je{create(e,t,s){return this._client.post(`/vector_stores/${e}/files`,{body:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}retrieve(e,t,s){return this._client.get(`/vector_stores/${e}/files/${t}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}list(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2?arguments[2]:void 0;return L(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,Ns,{query:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}del(e,t,s){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}async createAndPoll(e,t,s){const n=await this.create(e,t,s);return await this.poll(e,n.id,s)}async poll(e,t,s){const n={...s?.headers,"X-Stainless-Poll-Helper":"true"};for(s?.pollIntervalMs&&(n["X-Stainless-Custom-Poll-Interval"]=s.pollIntervalMs.toString());;){const r=await this.retrieve(e,t,{...s,headers:n}).withResponse(),o=r.data;switch(o.status){case"in_progress":let e=5e3;if(s?.pollIntervalMs)e=s.pollIntervalMs;else{const t=r.response.headers.get("openai-poll-after-ms");if(t){const s=parseInt(t);isNaN(s)||(e=s)}}await V(e);break;case"failed":case"completed":return o}}}async upload(e,t,s){const n=await this._client.files.create({file:t,purpose:"assistants"},s);return this.create(e,{file_id:n.id},s)}async uploadAndPoll(e,t,s){const n=await this.upload(e,t,s);return await this.poll(e,n.id,s)}};class Ns extends Be{}!function(e){e.VectorStoreFilesPage=Ns}(Ms||(Ms={}));class Bs extends je{create(e,t,s){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}retrieve(e,t,s){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}cancel(e,t,s){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}async createAndPoll(e,t,s){const n=await this.create(e,t);return await this.poll(e,n.id,s)}listFiles(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3?arguments[3]:void 0;return L(s)?this.listFiles(e,t,{},s):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,Ns,{query:s,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}async poll(e,t,s){const n={...s?.headers,"X-Stainless-Poll-Helper":"true"};for(s?.pollIntervalMs&&(n["X-Stainless-Custom-Poll-Interval"]=s.pollIntervalMs.toString());;){const{data:r,response:o}=await this.retrieve(e,t,{...s,headers:n}).withResponse();switch(r.status){case"in_progress":let e=5e3;if(s?.pollIntervalMs)e=s.pollIntervalMs;else{const t=o.headers.get("openai-poll-after-ms");if(t){const s=parseInt(t);isNaN(s)||(e=s)}}await V(e);break;case"failed":case"cancelled":case"completed":return r}}}async uploadAndPoll(e,t,s){let{files:n,fileIds:r=[]}=t;if(null==n||0==n.length)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const o=s?.maxConcurrency??5,a=Math.min(o,n.length),i=this._client,l=n.values(),c=[...r];const u=Array(a).fill(l).map((async function(e){for(let t of e){const e=await i.files.create({file:t,purpose:"assistants"},s);c.push(e.id)}}));return await(async e=>{const t=await Promise.allSettled(e),s=t.filter((e=>"rejected"===e.status));if(s.length){for(const e of s)console.error(e.reason);throw new Error(`${s.length} promise(s) failed - see the above errors`)}const n=[];for(const e of t)"fulfilled"===e.status&&n.push(e.value);return n})(u),await this.createAndPoll(e,{file_ids:c})}}Bs||(Bs={});class js extends je{constructor(){super(...arguments),this.files=new Ms(this._client),this.fileBatches=new Bs(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,s){return this._client.post(`/vector_stores/${e}`,{body:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}list(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return L(e)?this.list({},e):this._client.getAPIList("/vector_stores",Ls,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}}class Ls extends Be{}!function(e){e.VectorStoresPage=Ls,e.Files=Ms,e.VectorStoreFilesPage=Ns,e.FileBatches=Bs}(js||(js={}));class Ds extends je{constructor(){super(...arguments),this.vectorStores=new js(this._client),this.chat=new ts(this._client),this.assistants=new Je(this._client),this.threads=new Ts(this._client)}}!function(e){e.VectorStores=js,e.VectorStoresPage=Ls,e.Chat=ts,e.Assistants=Je,e.AssistantsPage=Ve,e.Threads=Ts}(Ds||(Ds={}));class Fs extends je{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}Fs||(Fs={});class qs extends je{create(e,t){return this._client.post("/embeddings",{body:e,...t})}}qs||(qs={});class Us extends je{create(e,t){return this._client.post("/files",A({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return L(e)?this.list({},e):this._client.getAPIList("/files",Ws,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/json",...t?.headers}})}async waitForProcessing(e){let{pollInterval:t=5e3,maxWait:s=18e5}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=new Set(["processed","error","deleted"]),r=Date.now();let o=await this.retrieve(e);for(;!o.status||!n.has(o.status);)if(await V(t),o=await this.retrieve(e),Date.now()-r>s)throw new le({message:`Giving up on waiting for file ${e} to finish processing after ${s} milliseconds.`});return o}}class Ws extends Ne{}!function(e){e.FileObjectsPage=Ws}(Us||(Us={}));class Hs extends je{list(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2?arguments[2]:void 0;return L(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,Xs,{query:t,...s})}}class Xs extends Be{}!function(e){e.FineTuningJobCheckpointsPage=Xs}(Hs||(Hs={}));class Js extends je{constructor(){super(...arguments),this.checkpoints=new Hs(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return L(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",Vs,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2?arguments[2]:void 0;return L(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,Ks,{query:t,...s})}}class Vs extends Be{}class Ks extends Be{}!function(e){e.FineTuningJobsPage=Vs,e.FineTuningJobEventsPage=Ks,e.Checkpoints=Hs,e.FineTuningJobCheckpointsPage=Xs}(Js||(Js={}));class zs extends je{constructor(){super(...arguments),this.jobs=new Js(this._client)}}!function(e){e.Jobs=Js,e.FineTuningJobsPage=Vs,e.FineTuningJobEventsPage=Ks}(zs||(zs={}));class Qs extends je{createVariation(e,t){return this._client.post("/images/variations",A({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",A({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}Qs||(Qs={});class Gs extends je{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",Ys,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}}class Ys extends Ne{}!function(e){e.ModelsPage=Ys}(Gs||(Gs={}));class Zs extends je{create(e,t){return this._client.post("/moderations",{body:e,...t})}}Zs||(Zs={});class en extends je{create(e,t,s){return this._client.post(`/uploads/${e}/parts`,A({body:t,...s}))}}en||(en={});class tn extends je{constructor(){super(...arguments),this.parts=new en(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(`/uploads/${e}/cancel`,t)}complete(e,t,s){return this._client.post(`/uploads/${e}/complete`,{body:t,...s})}}var sn;!function(e){e.Parts=en}(tn||(tn={}));class nn extends T{constructor(){let{baseURL:e=Q("OPENAI_BASE_URL"),apiKey:t=Q("OPENAI_API_KEY"),organization:s=Q("OPENAI_ORG_ID")??null,project:n=Q("OPENAI_PROJECT_ID")??null,...r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(void 0===t)throw new re("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const o={apiKey:t,organization:s,project:n,...r,baseURL:e||"https://api.openai.com/v1"};if(!o.dangerouslyAllowBrowser&&"undefined"!=typeof window&&void 0!==window.document&&"undefined"!=typeof navigator)throw new re("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew OpenAI({ apiKey, dangerouslyAllowBrowser: true });\n\nhttps://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety\n");super({baseURL:o.baseURL,timeout:o.timeout??6e5,httpAgent:o.httpAgent,maxRetries:o.maxRetries,fetch:o.fetch}),this.completions=new Fs(this),this.chat=new De(this),this.embeddings=new qs(this),this.files=new Us(this),this.images=new Qs(this),this.audio=new We(this),this.moderations=new Zs(this),this.models=new Gs(this),this.fineTuning=new zs(this),this.beta=new Ds(this),this.batches=new He(this),this.uploads=new tn(this),this._options=o,this.apiKey=t,this.organization=s,this.project=n}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return Me(e,{arrayFormat:"brackets"})}}sn=nn,nn.OpenAI=sn,nn.DEFAULT_TIMEOUT=6e5,nn.OpenAIError=re,nn.APIError=oe,nn.APIConnectionError=ie,nn.APIConnectionTimeoutError=le,nn.APIUserAbortError=ae,nn.NotFoundError=de,nn.ConflictError=fe,nn.RateLimitError=me,nn.BadRequestError=ce,nn.AuthenticationError=ue,nn.InternalServerError=ge,nn.PermissionDeniedError=he,nn.UnprocessableEntityError=pe,nn.toFile=_,nn.fileFromPath=l,function(e){e.Page=Ne,e.CursorPage=Be,e.Completions=Fs,e.Chat=De,e.Embeddings=qs,e.Files=Us,e.FileObjectsPage=Ws,e.Images=Qs,e.Audio=We,e.Moderations=Zs,e.Models=Gs,e.ModelsPage=Ys,e.FineTuning=zs,e.Beta=Ds,e.Batches=He,e.BatchesPage=Xe,e.Uploads=tn}(nn||(nn={})),document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("openAIKey"),t=localStorage.getItem("openAIKey");console.log({storedApiKey:t}),t&&(console.log("key is already there"),e.value=t,document.getElementById("openAiKeyInput").style.display="none")}));const rn={messages:[{role:"system",content:'You are a Language Learning system. You render html and receives the input from the function r().The output is always surrounded by STARTHTML and STOPHTML. For example, let`s say you are teaching articles, you first render: STARTHTML <p>Bitte wÃ¤hlen Sie den richtigen Artikel fÃ¼r <strong>Freiheit</strong> aus:</p> <button onclick="r(\'der\')">Der</button><button onclick="r(\'die\')">Die</button><button onclick="r(\'das\')">Das</button> STOPHTML Or maybe an input:STARTHTML<p>Input the German Article for Freiheit:</p><input type="text" id="answerInput" placeholder="Enter der, die, or das"><button onclick="r(document.getElementById(\'answerInput\').value)">Answer</button> STOPHTML Use wathever is best for the question. After you will get the output from the function r, for example:derSTARTHTML<p>Tut mir leid, die Antwort ist der</p><p>Substantive mit den folgenden Suffixen haben den Artikel "die":</p><table border="1"> <tr> <th>Suffix</th> <th>Beispiele</th> </tr><tr><td>-falt</td><td>Vielfalt</td></tr><tr><td>-heit</td><td>Freiheit, Sicherheit</td></tr><tr><td>-keit</td><td>MÃ¶glichkeit, Schnelligkeit</td></tr><tr><td>-schaft</td><td>Freundschaft, Mannschaft</td></tr><tr><td>-t (von Verben abgeleitete Substantive)</td><td>Fahrt, Tat</td></tr><tr><td>-ung</td><td>Leitung, Zeitung</td></tr></table><p>Lasst uns weitermachen. Bitte wÃ¤hlen Sie den richtigen Artikel fÃ¼r <strong>Apfell</strong> aus:</p><button onclick="r(\'der\')">Der</button><button onclick="r(\'die\')">Die</button><button onclick="r(\'das\')">Das</button> STOPHTML Some input that calls the function r("") is always required. It can be either buttons, text input, radiobuttons or any that fits the question.Student level is A2. Please give lengthy explanations before asking for a response.'}],openai:null};async function on(e){try{t=e,rn.messages.push({role:"user",content:t});const s=(await rn.openai.chat.completions.create({model:"gpt-4o-mini",messages:rn.messages})).choices[0].message.content,n=document.getElementById("result");n.textContent="Generating...";const r=s.match(/STARTHTML([\s\S]*?)STOPHTML/);if(r&&r[1]){const e=r[1];n.innerHTML=e,function(e){rn.messages.push({role:"assistant",content:e})}(s),document.getElementById("result").classList.remove("disabled")}else n.textContent="Sorry I got lost"}catch(e){console.error("Error:",e),resultDiv.textContent="Error: "+e.message,document.getElementById("openAiKeyInput").style.display="flex"}var t}document.getElementById("generate").addEventListener("click",(async()=>{document.getElementById("generate").classList.add("disabled");const e=document.getElementById("prompt").value,t=document.getElementById("openAIKey").value;localStorage.setItem("openAIKey",t),rn.openai=new nn({apiKey:t,dangerouslyAllowBrowser:!0}),await on(e),document.getElementById("generate").classList.remove("disabled")})),document.getElementById("prompt").addEventListener("keypress",(function(e){"Enter"===e.key&&(e.preventDefault(),document.getElementById("generate").click())})),window.r=function(e){document.getElementById("result").classList.add("disabled"),on(e)}}();